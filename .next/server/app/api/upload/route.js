"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:e=>{e.exports=require("fs")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},8470:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>j,originalPathname:()=>b,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>w,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>h});var o={};i.r(o),i.d(o,{DELETE:()=>m,GET:()=>c,POST:()=>d});var r=i(5419),s=i(9108),a=i(9678),l=i(8070),n=i(3292),p=i(1017),u=i(7147);async function d(e){try{let t;let i=await e.formData(),o=i.get("file"),r=i.get("type")||"image";if(!o)return l.Z.json({error:"No file received"},{status:400});let s="video"===r?["video/mp4","video/webm","video/mov","video/avi"]:["image/jpeg","image/jpg","image/png","image/gif","image/webp"];if(!s.includes(o.type))return l.Z.json({error:`Invalid file type. Allowed types: ${s.join(", ")}`},{status:400});let a="video"===r?52428800:10485760;if(o.size>a)return l.Z.json({error:`File too large. Max size: ${a/1048576}MB`},{status:400});let d=await o.arrayBuffer(),c=Buffer.from(d),m=(0,p.join)(process.cwd(),"public","uploads","video"===r?"videos":"images");(0,u.existsSync)(m)||await (0,n.mkdir)(m,{recursive:!0});let g=o.name.split(".").pop()?.toLowerCase()||"";if("video"===r)t=`bg-video.${g}`;else{let e=o.name.toLowerCase();t=e.includes("logo")?`logo.${g}`:e.includes("hero")||e.includes("banner")?`hero-image.${g}`:e.includes("bike")||e.includes("product")?`bike-${Date.now()}.${g}`:`image-${Date.now()}.${g}`}let f=t.split(".")[0];if(!["bg-video","logo","hero-image"].includes(f)){let e=1,i=t;for(;(0,u.existsSync)((0,p.join)(m,i));){let o=t.split(".").slice(0,-1).join("."),r=t.split(".").pop();i=`${o}-${e}.${r}`,e++}t=i}let v=(0,p.join)(m,t);await (0,n.writeFile)(v,c);let w=`/uploads/${"video"===r?"videos":"images"}/${t}`;return l.Z.json({success:!0,filename:t,url:w,size:o.size,type:o.type,uploadedAt:new Date().toISOString()})}catch(e){return console.error("Upload error:",e),l.Z.json({error:"Failed to upload file"},{status:500})}}async function c(e){try{let{searchParams:t}=new URL(e.url),o=t.get("type")||"all",{readdir:r,stat:s}=await Promise.resolve().then(i.t.bind(i,3292,23)),{join:a}=await Promise.resolve().then(i.t.bind(i,1017,23)),{existsSync:n}=await Promise.resolve().then(i.t.bind(i,7147,23)),p=[];if("all"===o||"image"===o){let e=a(process.cwd(),"public","uploads","images");if(n(e))for(let t of(await r(e))){let i=a(e,t),o=await s(i),r=t.toLowerCase().split(".").pop(),l={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"};l[r||""]&&p.push({id:t,filename:t,url:`/uploads/images/${t}`,type:l[r||""],size:o.size,uploadedAt:o.mtime.toISOString()})}}if("all"===o||"video"===o){let e=a(process.cwd(),"public","uploads","videos");if(n(e))for(let t of(await r(e))){let i=a(e,t),o=await s(i),r=t.toLowerCase().split(".").pop(),l={mp4:"video/mp4",webm:"video/webm",mov:"video/mov",avi:"video/avi"};l[r||""]&&p.push({id:t,filename:t,url:`/uploads/videos/${t}`,type:l[r||""],size:o.size,uploadedAt:o.mtime.toISOString()})}}return p.sort((e,t)=>new Date(t.uploadedAt).getTime()-new Date(e.uploadedAt).getTime()),l.Z.json({success:!0,files:p})}catch(e){return console.error("Get files error:",e),l.Z.json({error:"Failed to fetch files"},{status:500})}}async function m(e){try{let{searchParams:t}=new URL(e.url),o=t.get("filename"),r=t.get("type");if(!o||!r)return l.Z.json({error:"Missing filename or type"},{status:400});let{unlink:s}=await Promise.resolve().then(i.t.bind(i,3292,23)),{existsSync:a}=await Promise.resolve().then(i.t.bind(i,7147,23)),n=(0,p.join)(process.cwd(),"public","uploads","video"===r?"videos":"images",o);if(a(n))return await s(n),l.Z.json({success:!0,message:"File deleted successfully"});return l.Z.json({error:"File not found"},{status:404})}catch(e){return console.error("Delete error:",e),l.Z.json({error:"Failed to delete file"},{status:500})}}let g=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/Users/smartsoftwareservicespvtltd/Downloads/bikedeal/src/app/api/upload/route.ts",nextConfigOutput:"export",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:v,serverHooks:w,headerHooks:j,staticGenerationBailout:h}=g,b="/api/upload/route";function y(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:v})}}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),o=t.X(0,[638,206],()=>i(8470));module.exports=o})();